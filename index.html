<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仓库快速盘点系统</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .input-section {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 10px;
        }
        label {
            display: inline-block;
            width: 100px;
            font-weight: bold;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100px;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .action-buttons {
            margin-top: 20px;
            text-align: center;
        }
        .location-input {
            display: inline-block;
            margin-right: 10px;
        }
        #itemName, #itemModel {
            width: 200px;
        }
        #itemQuantity {
            width: 80px;
        }
        .navigation-buttons {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>仓库快速盘点系统</h1>
        
        <div class="input-section">
            <div class="navigation-buttons">
                <button id="prevLocation">上一个位置</button>
                <button id="nextLocation">下一个位置</button>
            </div>
            
            <div class="form-group">
                <div class="location-input">
                    <label for="shelf">货架(X):</label>
                    <input type="number" id="shelf" min="1" value="1">
                </div>
                <div class="location-input">
                    <label for="level">层(Y):</label>
                    <input type="number" id="level" min="1" value="1">
                </div>
                <div class="location-input">
                    <label for="section">格(Z):</label>
                    <select id="section">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="itemName">物资名称:</label>
                <input type="text" id="itemName" placeholder="请输入物资名称">
            </div>
            
            <div class="form-group">
                <label for="itemQuantity">数量:</label>
                <input type="number" id="itemQuantity" min="0" value="1">
            </div>
            
            <div class="form-group">
                <label for="itemModel">型号(可选):</label>
                <input type="text" id="itemModel" placeholder="请输入型号">
            </div>
            
            <button id="addItem">添加记录</button>
            <button id="clearItem">清除当前输入</button>
        </div>
        
        <div class="action-buttons">
            <button id="exportExcel">导出Excel</button>
            <button id="exportCSV">导出CSV</button>
            <button id="clearAll">清除所有记录</button>
        </div>
        
        <table id="inventoryTable">
            <thead>
                <tr>
                    <th>位置(X-Y-Z)</th>
                    <th>物资名称</th>
                    <th>数量</th>
                    <th>型号</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="inventoryBody">
                <!-- 数据将在这里动态添加 -->
            </tbody>
        </table>
    </div>

    <script>
        // 初始化库存数据
        let inventoryData = JSON.parse(localStorage.getItem('inventoryData')) || [];
        
        // DOM元素
        const shelfInput = document.getElementById('shelf');
        const levelInput = document.getElementById('level');
        const sectionInput = document.getElementById('section');
        const itemNameInput = document.getElementById('itemName');
        const itemQuantityInput = document.getElementById('itemQuantity');
        const itemModelInput = document.getElementById('itemModel');
        const addItemBtn = document.getElementById('addItem');
        const clearItemBtn = document.getElementById('clearItem');
        const exportExcelBtn = document.getElementById('exportExcel');
        const exportCSVBtn = document.getElementById('exportCSV');
        const clearAllBtn = document.getElementById('clearAll');
        const inventoryBody = document.getElementById('inventoryBody');
        const prevLocationBtn = document.getElementById('prevLocation');
        const nextLocationBtn = document.getElementById('nextLocation');
        
        // 渲染表格
        function renderTable() {
            inventoryBody.innerHTML = '';
            
            inventoryData.forEach((item, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.location}</td>
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>${item.model || '-'}</td>
                    <td>
                        <button onclick="editItem(${index})">编辑</button>
                        <button onclick="deleteItem(${index})">删除</button>
                    </td>
                `;
                
                inventoryBody.appendChild(row);
            });
        }
        
        // 添加新记录
        function addItem() {
            const shelf = shelfInput.value;
            const level = levelInput.value;
            const section = sectionInput.value;
            const name = itemNameInput.value.trim();
            const quantity = itemQuantityInput.value;
            const model = itemModelInput.value.trim();
            
            if (!name) {
                alert('请输入物资名称');
                return;
            }
            
            if (!quantity || quantity <= 0) {
                alert('请输入有效的数量');
                return;
            }
            
            const location = `${shelf}-${level}-${section}`;
            
            inventoryData.push({
                location,
                name,
                quantity,
                model
            });
            
            // 保存到本地存储
            localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
            
            // 清空输入框
            clearInputs();
            
            // 渲染表格
            renderTable();
            
            // 自动跳到下一个位置
            nextLocation();
        }
        
        // 编辑记录
        function editItem(index) {
            const item = inventoryData[index];
            const [shelf, level, section] = item.location.split('-');
            
            shelfInput.value = shelf;
            levelInput.value = level;
            sectionInput.value = section;
            itemNameInput.value = item.name;
            itemQuantityInput.value = item.quantity;
            itemModelInput.value = item.model || '';
            
            // 删除原记录
            inventoryData.splice(index, 1);
            localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
            renderTable();
        }
        
        // 删除记录
        function deleteItem(index) {
            if (confirm('确定要删除这条记录吗？')) {
                inventoryData.splice(index, 1);
                localStorage.setItem('inventoryData', JSON.stringify(inventoryData));
                renderTable();
            }
        }
        
        // 清空输入
        function clearInputs() {
            itemNameInput.value = '';
            itemQuantityInput.value = '1';
            itemModelInput.value = '';
        }
        
        // 清空所有记录
        function clearAll() {
            if (confirm('确定要清除所有盘点记录吗？此操作不可恢复！')) {
                inventoryData = [];
                localStorage.removeItem('inventoryData');
                renderTable();
            }
        }
        
        // 导出Excel
        function exportToExcel() {
            if (inventoryData.length === 0) {
                alert('没有数据可导出');
                return;
            }
            
            // 准备数据
            const exportData = inventoryData.map(item => ({
                '位置(X-Y-Z)': item.location,
                '物资名称': item.name,
                '数量': item.quantity,
                '型号': item.model || ''
            }));
            
            // 创建工作簿
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // 添加工作表到工作簿
            XLSX.utils.book_append_sheet(wb, ws, '仓库盘点数据');
            
            // 导出文件
            XLSX.writeFile(wb, `仓库盘点_${new Date().toLocaleDateString()}.xlsx`);
        }
        
        // 导出CSV
        function exportToCSV() {
            if (inventoryData.length === 0) {
                alert('没有数据可导出');
                return;
            }
            
            // CSV标题行
            let csv = '位置(X-Y-Z),物资名称,数量,型号\n';
            
            // 添加数据行
            inventoryData.forEach(item => {
                csv += `"${item.location}","${item.name}",${item.quantity},"${item.model || ''}"\n`;
            });
            
            // 创建下载链接
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `仓库盘点_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // 上一个位置
        function prevLocation() {
            let section = parseInt(sectionInput.value);
            let level = parseInt(levelInput.value);
            let shelf = parseInt(shelfInput.value);
            
            if (section > 1) {
                section--;
            } else {
                section = 4;
                if (level > 1) {
                    level--;
                } else {
                    level = 1;
                    if (shelf > 1) {
                        shelf--;
                    }
                }
            }
            
            sectionInput.value = section;
            levelInput.value = level;
            shelfInput.value = shelf;
        }
        
        // 下一个位置
        function nextLocation() {
            let section = parseInt(sectionInput.value);
            let level = parseInt(levelInput.value);
            let shelf = parseInt(shelfInput.value);
            
            if (section < 4) {
                section++;
            } else {
                section = 1;
                level++;
                // 假设每货架有固定层数，这里假设为5层
                if (level > 5) {
                    level = 1;
                    shelf++;
                }
            }
            
            sectionInput.value = section;
            levelInput.value = level;
            shelfInput.value = shelf;
        }
        
        // 事件监听
        addItemBtn.addEventListener('click', addItem);
        clearItemBtn.addEventListener('click', clearInputs);
        exportExcelBtn.addEventListener('click', exportToExcel);
        exportCSVBtn.addEventListener('click', exportToCSV);
        clearAllBtn.addEventListener('click', clearAll);
        prevLocationBtn.addEventListener('click', prevLocation);
        nextLocationBtn.addEventListener('click', nextLocation);
        
        // 初始渲染
        renderTable();
        
        // 全局函数
        window.editItem = editItem;
        window.deleteItem = deleteItem;
    </script>
</body>
</html>